LAMP Install Notes 20161019 2016.293
Copyright Â© 2014, 2015, 2016, William N. Braswell, Jr.. All Rights Reserved. This work is Free & Open Source; you can redistribute it and/or modify it under the same terms as Perl 5.24.0.

# [[[ UNINDENT ]]]
:%s/^\ \ \ \ //g


# [[[ PERL SHINYCMS, CREATE DATABASE & EDIT MYSHINYTEMPLATE FILES ]]]
$ mysql --user=root --password
    mysql> CREATE DATABASE SOMEDOMAIN_COM;
    mysql> GRANT ALL PRIVILEGES ON SOMEDOMAIN_COM.* TO 'SOME_MYSQL_USER'@'localhost' IDENTIFIED BY 'SOME_MYSQL_PASS';
    mysql> QUIT
$ rm modified/shinycms.conf; mv shinycms.conf.redacted modified/shinycms.conf; ln -s modified/shinycms.conf ./shinycms.conf
$ vi shinycms.conf
    name   ShinyCMS
    author SOME BODY <SOMEBODY@EXTERNALDOMAIN.COM>
    site_name    SOMEDOMAIN
    domain       SOMEDOMAIN.COM
    email_from   SOMEBODY@SOMEDOMAIN.COM
    ...
    <Model::DB>
            schema_class ShinyCMS::Schema
            <connect_info>
                    dsn        dbi:mysql:SOMEDOMAIN_COM
                    user       SOME_MYSQL_USER
                    password   SOME_MYSQL_PASS
                    ...
            </connect_info>
    </Model::DB>
$ make clean
$ grep -nr myshiny ./*
    # EDIT EVERY NON-SYMLINK FILE LISTED, SHOULD FOLLOW AS BELOW
    # replace both "myshinytemplate.com" & "myshinytemplate_com"; also "template_user" & "wbraswell"
    # :%s/myshinytemplate\.com/SOMEDOMAIN\.COM/g
    # :%s/myshinytemplate_com/SOMEDOMAIN_COM/g
    # :%s/MyShinyTemplate\.com/SOMEDOMAIN\.COM/g
    # :%s/template_user/SOME_MYSQL_USER/g
    # :%s/wbraswell/SOMEBODY/g
$ cd modified
$ vi README.md
$ vi external-fastcgi-server
$ vi fastcgi_start__myshinytemplate.com.sh
$ mv fastcgi_start__myshinytemplate.com.sh fastcgi_start__SOMEDOMAIN.COM.sh
$ vi fastcgi_myshinytemplate.com.conf
$ mv fastcgi_myshinytemplate.com.conf fastcgi_SOMEDOMAIN.COM.conf
$ vi fastcgi_myshinytemplate.com-init.d
$ mv fastcgi_myshinytemplate.com-init.d fastcgi_SOMEDOMAIN.COM-init.d
$ vi git_backup__myshinytemplate.com.sh
$ mv git_backup__myshinytemplate.com.sh git_backup__SOMEDOMAIN.COM.sh
$ vi git_merge_modified__myshinytemplate.com.sh
$ mv git_merge_modified__myshinytemplate.com.sh git_merge_modified__SOMEDOMAIN.COM.sh
$ vi mysqldump__myshinytemplate.com__no_user.sh.redacted  # DO NOT ADD PASSWORD HERE
$ mv mysqldump__myshinytemplate.com__no_user.sh.redacted mysqldump__SOMEDOMAIN.COM__no_user.sh.redacted
$ mkdir ~/bin; cp mysqldump__SOMEDOMAIN.COM__no_user.sh.redacted ~/bin/mysqldump__SOMEDOMAIN.COM__no_user.sh
$ vi ~/bin/mysqldump__SOMEDOMAIN.COM__no_user.sh  # ADD PASSWORD, USE SINGLE QUOTES IF SPECIAL CHARACTERS
$ ln -s ~/public_html/SOMEDOMAIN.COM-latest/modified/*.sh ~/bin
$ cd ..
$ rm backup/*.bz2
$ grep -nr myshiny ./*
$ grep -nr MyShiny ./*
    # ENSURE NO FILES REMAIN
$ find | grep myshiny
$ find | grep MyShiny
$ find | grep template_user
    # ENSURE NO FILES REMAIN


# [[[ PERL SHINYCMS, BUILD DEMO DATA & RUN TESTS ]]]
$ ./bin/database/build-with-demo-data  # YES DEMO DATA, INCLUDING USER CREDENTIALS admin/changeme
$ export TEST_POD=1
$ perl Makefile.PL; make; make test
$ ./script/shinycms_server.pl
    # LOG IN AS ADMIN, CREDENTIALS admin/changeme
    # CHANGE ALL PASSWORDS NOW!!!
    # Admin area -> Users -> List users -> Change passwords for "admin" & "trevor" & "w1n5t0n"


# [[[ PERL SHINYCMS, BACKUP & RESTORE DATABASE ]]]
$ mysqldump --user=SOME_MYSQL_USER --password='SOME_MYSQL_PASS' SOMEDOMAIN_COM --lock-all-tables --ignore-table=SOMEDOMAIN_COM.user > SOMEDOMAIN_COM__no_user.sql  # NO USER, BACKUP
$ mysql --user=root --password
    mysql> CREATE DATABASE SOMEDOMAIN_COM;  # NO USER, CREATE EMPTY DB TO RECEIVE RESTORE
    mysql> GRANT ALL PRIVILEGES ON SOMEDOMAIN_COM.* TO 'SOME_MYSQL_USER'@'localhost' IDENTIFIED BY 'SOME_MYSQL_PASS';
$ mysql --user=SOME_MYSQL_USER --password='SOME_MYSQL_PASS' SOMEDOMAIN_COM < SOMEDOMAIN_COM__no_user.sql  # NO USER TABLE, YES MYSQL USER, RESTORE 


# [[[ PERL SHINYCMS, CONFIGURE APACHE MOD_FASTCGI ]]]
# [ YOU SHOULD USE THIS UNLESS YOU HAVE NO CHOICE ]
# [ DO NOT MIX WITH APACHE MOD_PERL, BELOW ]
$ cpanm FCGI FCGI::ProcManager  # NOT ROOT IF local::lib
$ a2enmod fastcgi
$ vi /etc/apache2/sites-available/SOMEDOMAIN.COM.conf
    <VirtualHost *:80>
        ServerName SOMEDOMAIN.COM
        ServerAlias www.SOMEDOMAIN.COM
        ServerAdmin webmaster@SOMEDOMAIN.COM
    #    DocumentRoot /srv/www/SOMEDOMAIN.COM/public_html/  # mod_fastcgi overrides below
        <Directory />  # required for Apache v2.4 in Ubuntu v14.04.pre
            Require all granted
        </Directory>
        ErrorLog /srv/www/SOMEDOMAIN.COM/logs/error.log
        CustomLog /srv/www/SOMEDOMAIN.COM/logs/access.log combined
    # MOD_FASTCGI
        DocumentRoot    /home/SOMEBODY/public_html/SOMEDOMAIN.COM-latest/root
        <Location />
            Order allow,deny
            Allow from all
        </Location>
        # Google Webmaster Tools, Robots Testing Tool 
        Alias    /googleSOMELONGNUMBER.html    /home/SOMEBODY/public_html/SOMEDOMAIN.COM-latest/root/googleSOMELONGNUMBER.html
        # Allow Apache to serve static content.
        Alias       /static     /home/SOMEBODY/public_html/SOMEDOMAIN.COM-latest/root/static
        <Location /static>  # UNNECESSARY???
            SetHandler          default-handler
        </Location>
        # Display friendly error page if the FastCGI process is not running.
        ErrorDocument   502     /home/SOMEBODY/public_html/SOMEDOMAIN.COM-latest/root/offline.html
        # Connect to the external server.
        FastCgiExternalServer   /tmp/SOMEDOMAIN.COM.fcgi -socket /tmp/SOMEDOMAIN.COM.socket -idle-timeout 900
        Alias           /       /tmp/SOMEDOMAIN.COM.fcgi/
    </VirtualHost>
$ cd /home/SOMEBODY/public_html/SOMEDOMAIN-latest
$ vi modified/offline.html
    <b>ERROR 502:</b> FastCGI Process Not Running, Please Inform Site Administrator <a href="mailto:SOMEBODY@SUBDOMAIN.SOMEDOMAIN.COM">ADMIN NAME</a>
# START FASTCGI SERVER, MANUAL
$ ~/bin/fastcgi_start__SOMEDOMAIN.COM.sh  # LOCAL::LIB, RUN AS USER SOMEBODY BY USER SOMEBODY, MUST HAVE CREATED SYMLINKS IN EDIT-MYSHINYTEMPLATE-FILES SECTION ABOVE
    # OR
$ sudo -Eu SOMEBODY /home/SOMEBODY/public_html/SOMEDOMAIN-latest/bin/external-fastcgi-server  # PERLBREW, RUN AS USER SOMEBODY BY USER root
$ cat /tmp/SOMEDOMAIN.COM.pid
# START FASTCGI SERVER, AUTOMATIC
$ ln -s /home/SOMEBODY/public_html/SOMEDOMAIN-latest/modified/fastcgi_SOMEDOMAIN.COM.conf /etc/init  # UPSTART, MOST MODERN LINUX DISTROS
$ initctl reload-configuration  # OR    $ reboot
$ initctl list | grep SOMEDOMAIN
$ service fastcgi_SOMEDOMAIN.COM start
$ service fastcgi_SOMEDOMAIN.COM status
    # OR
$ ln -s /home/SOMEBODY/public_html/SOMEDOMAIN-latest/modified/fastcgi_SOMEDOMAIN.COM-init.d /etc/init.d  # SYSV-INIT, OLDER LINUX DISTROS
$ reboot


# [[[ PERL SHINYCMS, CONFIGURE APACHE MOD_PERL ]]]
# [ DO NOT USE THIS UNLESS YOU HAVE NO CHOICE ]
# [ DO NOT MIX WITH APACHE MOD_FASTCGI, ABOVE ]
$ vi /etc/apache2/sites-available/SOMEDOMAIN.COM.conf
    # DOMAIN
    <VirtualHost *:80>
        ServerName SOMEDOMAIN.COM
        ServerAlias www.SOMEDOMAIN.COM
        ServerAdmin webmaster@SOMEDOMAIN.COM
        DocumentRoot /srv/www/SOMEDOMAIN.COM/public_html/
        <Directory />  # required for Apache v2.4 in Ubuntu v14.04.pre
            Require all granted
        </Directory>
        # Google Webmaster Tools, Robots Testing Tool 
        Alias    /googleSOMELONGNUMBER.html    /home/SOMEBODY/public_html/SOMEDOMAIN.COM-latest/root/googleSOMELONGNUMBER.html
        ErrorLog /srv/www/SOMEDOMAIN.COM/logs/error.log
        CustomLog /srv/www/SOMEDOMAIN.COM/logs/access.log combined
        <Perl>
            use lib '/home/SOMEBODY/public_html/SOMEDOMAIN.COM-latest/lib';  # ShinyCMS
            use lib '/home/SOMEBODY/perl5/lib/perl5';  # local::lib
        </Perl>
    #   PerlRequire     /home/example.com/code/ShinyCMS/startup.pl  # handled by 'use lib' code above 
        PerlModule      ShinyCMS
        Alias   /static     /home/SOMEBODY/public_html/SOMEDOMAIN.COM-latest/root/static
        <Location />
            SetHandler          modperl 
            PerlResponseHandler +ShinyCMS
        </Location>
        <Location /static>  # UNNECESSARY???
            SetHandler  default-handler
        </Location>
    </VirtualHost>
        # OR
    # SUBDOMAIN
    <VirtualHost *:80>
        ServerName SUBDOMAIN.SOMEDOMAIN.COM
        ServerAdmin webmaster@SOMEDOMAIN.COM
        DocumentRoot /srv/www/SUBDOMAIN.SOMEDOMAIN.COM/public_html/
        <Directory />  # required for Apache v2.4 in Ubuntu v14.04.pre
            Require all granted
        </Directory>
        # Google Webmaster Tools, Robots Testing Tool 
        Alias    /googleSOMELONGNUMBER.html    /home/SOMEBODY/public_html/SUBDOMAIN.SOMEDOMAIN.COM-latest/root/googleSOMELONGNUMBER.html
        ErrorLog /srv/www/SUBDOMAIN.SOMEDOMAIN.COM/logs/error.log
        CustomLog /srv/www/SUBDOMAIN.SOMEDOMAIN.COM/logs/access.log combined
        <Perl>
            use lib '/home/SOMEBODY/public_html/SUBDOMAIN.SOMEDOMAIN.COM-latest/lib';  # ShinyCMS
            use lib '/home/SOMEBODY/perl5/lib/perl5';  # local::lib
        </Perl>
    #   PerlRequire     /home/SOMEBODY/public_html/SUBDOMAIN.SOMEDOMAIN.COM-latest/startup.pl  # handled by 'use lib' code above 
        PerlModule      ShinyCMS
        Alias   /static     /home/SOMEBODY/public_html/SUBDOMAIN.SOMEDOMAIN.COM-latest/root/static
        <Location />
            SetHandler          modperl 
            PerlResponseHandler +ShinyCMS
        </Location>
        <Location /static>  # UNNECESSARY???
            SetHandler  default-handler
        </Location>
    </VirtualHost>


# [[[ PERL SHINYCMS, CREATE APACHE DIRECTORIES ]]]
$ mkdir -p /srv/www/SOMEDOMAIN.COM/public_html
$ mkdir /srv/www/SOMEDOMAIN.COM/logs
$ vi /srv/www/SOMEDOMAIN.COM/public_html/index.html  # create static test page
    SOMEDOMAIN.COM STATIC PAGE
$ a2ensite SOMEDOMAIN.COM


# [[[ PERL SHINYCMS, CONFIGURE APACHE PERMISSIONS ]]]
$ vi /etc/group  # allow SOMEBODY user to modify permissions
    www-data:x:33:SOMEBODY
$ chown -R SOMEBODY:www-data /home/SOMEBODY/
$ chmod -R u+rwX,o+rX,o-w /home/SOMEBODY/public_html/SOMEDOMAIN-latest
$ chmod -R g+rwX /home/SOMEBODY/public_html/SOMEDOMAIN-latest/root/static/cms-uploads/
$ chmod -R g+rX /home/SOMEBODY/
$ service apache2 reload


# [[[ PERL SHINYCMS, CONFIGURE SHINY ]]]
# http://phpmyadmin.SOMEDOMAIN.COM
    database "SOMEDOMAIN_COM"
    table "user" 
    change usernames "admin", "trevor" & "w1n5t0n"
# Shiny Login As New Admin User
# Admin area -> Users -> List Users -> Change Passwords For All 3 Users DOUBLE CHECK, SHOULD ALREADY BE DONE ABOVE
# Admin area -> Users -> List Users -> Edit All 3 Users -> Update E-Mail, etc.
# Admin area -> Pages -> List Form Handlers -> Edit Contact Form -> Update "E-mail To" Field
# Admin area -> Pages -> List Pages -> Edit Home -> Add Image "/static/cms-uploads/images/homepage_added.png" & "Lorem Ipsum Dolor" Text
# Admin area -> Pages -> List Templates -> Edit Homepage -> Delete "video_url" Element -> Update
